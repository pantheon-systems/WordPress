var WCML_Dialog=WCML_Dialog||{};jQuery(function(s){var d;WCML_Dialog.dialog=function(i,o){var t=this;void 0===i&&(i="generic"),t.overflow_y=s("body").css("overflow-y"),s("body").css("overflow-y","hidden"),d=s("#wcml-dialog-"+i);var a=s("#"+i).attr("title");if(void 0===a&&(a="undefined"!=o.title?o.title:""),void 0===o.class&&(o.class=""),void 0===o.draggable&&(o.draggable=!1),!d.length){s(document.body).append(s('<div class="wcml-dialog-container" title="'+a+'" id="wcml-dialog-'+i+'" />')),d=s("#wcml-dialog-"+i);var e=s(window).height(),l={title:"",autoOpen:!1,show:!0,dialogClass:"wcml-ui-dialog otgs-ui-dialog "+o.class,position:{my:"center",at:"center",of:window},modal:!0,width:"90%",height:"auto",resizable:!1,draggable:o.draggable,beforeOpen:function(i){},beforeClose:function(i){},close:function(i){s("#jquery-ui-style-css").removeAttr("disabled"),s("body").css("overflow-y",t.overflow_y)},create:function(i){},focus:function(i){},open:function(i){s("body").css("overflow","hidden"),s("#jquery-ui-style-css").attr("disabled","disabled"),"wcml-cs-dialog"===o.class&&WCML_Dialog._attachDialogScrollEvent()},refresh:function(i){}};void 0!==o.height&&"wcml-cs-dialog"!=o.class&&(l.height=Math.min(.7*e,o.height)),void 0!==o.width&&"wcml-cs-dialog"!=o.class&&(l.width=o.width),WCML_Dialog.using_wpdialog?d.wpdialog(l):d.dialog(l).on("dialogopen",function(){WCML_Dialog._repositionDialog()})}var n=_.debounce(function(){WCML_Dialog._repositionDialog(),"wcml-cs-dialog"===o.class&&WCML_Dialog._attachDialogScrollEvent()},200);if(WCML_Dialog.using_wpdialog?d.wpdialog("open"):d.dialog("open"),o.action){var c=s('<div class="spinner"></div>');c.css({display:"inline-block",visibility:"visible",float:"none"}),d.html(c),s.ajax({url:ajaxurl,type:"post",dataType:"json",data:o,success:function(i){d.html(i.html)}})}return o.content&&s("#"+o.content).length&&d.html(s("#"+o.content).html()),"undefined"!=typeof WCML_Tooltip&&WCML_Tooltip.init(),s(window).resize(n),!1},WCML_Dialog._repositionDialog=function(){var i=s(window).height()-180;d.css("max-height",i),setTimeout(function(){d.dialog("option","position",{my:"center",at:"center",of:window})},50)},WCML_Dialog._attachDialogScrollEvent=function(){var i=d.find(".wcml-currency-preview-wrapper"),o=900<d.width(),t=i.height()+200<d.height();(t=t||o&&i.height()<d.height())?d.on("scroll.preview",function(){d.find(".wcml-currency-preview-wrapper").css({position:"relative",top:d.scrollTop()})}):d.off("scroll.preview").find(".wcml-currency-preview-wrapper").css({position:"relative",top:0})},WCML_Dialog._register_open_handler=function(){s(document).on("click",".js-wcml-dialog-trigger",function(i){i.preventDefault();var o=!1;s(this).data("dialog")?o=s(this).data("dialog"):s(this).data("action")&&(o=s(this).data("action")),o&&(s(this).data("action")&&s(this).data("action",s(this).data("action").replace(/-/g,"_")),WCML_Dialog.dialog(o,s(this).data()))}),s(document).on("click",".js-wcml-cs-dialog-trigger",function(i){i.preventDefault();var o=!1;s(this).data("dialog")&&(o=s(this).data("dialog"));var t=s(this).data();t.class="wcml-cs-dialog",t.draggable=!0,o&&(WCML_Dialog.dialog(o,t),WCML_Currency_Switcher_Settings.initColorPicker(),WCML_Currency_Switcher_Settings.currency_switcher_preview(s("#wcml-dialog-"+o)))})},WCML_Dialog._register_close_handler=function(){s(document).on("click",".wcml-dialog-close-button",function(i){i.preventDefault(),"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),s(".wcml-dialog").find(".mce_editor textarea").each(function(){var i=s(this).attr("id"),o=s(this);if(i in tinyMCE.editors){var t=tinyMCE.get(i);t.isHidden()||o.val(t.getContent())}});var o=s(this).closest(".wcml-dialog-container"),t=s(this);t.attr("disabled","disabled");var a=s(this).data();if(a.action){var e=s('<div class="spinner"></div>');e.css({visibility:"visible",float:"right"}).prependTo(s(".wcml-dialog-footer .alignright")),s.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:a.action,fields:t.closest(".wcml-dialog-container").find("form").serialize(),icl_nonce:a.nonce},async:!1,success:function(i){a.stay&&(e.remove(),t.removeAttr("disabled"))}})}a.stay||(t.trigger("before_close_dialog"),WCML_Dialog.using_wpdialog?o.wpdialog("close"):o.dialog("close"))})},WCML_Dialog.init=function(){s(document).ready(function(){void 0!==s.wp?WCML_Dialog.using_wpdialog=void 0!==s.wp.wpdialog:WCML_Dialog.using_wpdialog=!1,WCML_Dialog._register_open_handler(),WCML_Dialog._register_close_handler()})},WCML_Dialog.init()});