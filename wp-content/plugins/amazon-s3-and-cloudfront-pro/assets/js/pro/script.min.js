!function(a,b,c){function d(c){var d=n.find(".support-content"),e=new o;a(".as3cf-pro-licence-notice").remove(),e.check({licence:c}).done(function(c){b.isEmpty(c.dbrains_api_down)?b.isArray(c.htmlErrors)&&c.htmlErrors.length?d.html(c.htmlErrors.join("")):d.html(c.message):d.html(c.dbrains_api_down+c.message),b.isEmpty(c.pro_error)||0!==a(".as3cf-pro-licence-notice").length||a("h2.nav-tab-wrapper").after(c.pro_error)})}function e(b){var c=a(b).serializeArray(),d={};return a.each(c,function(a,b){d[b.name]=b.value}),d}function f(b){if("support"!==b&&a(".as3cf-pro-check-again").length){var c=a(".as3cf-pro-check-again").attr("href");as3cf.tabs.defaultTab===b&&(b=""),""!==b&&(b="#"+b);var d=c.indexOf("#");0===d&&(d=c.length),c=c.substr(0,d)+b,a(".as3cf-pro-check-again").attr("href",c)}}function g(b){b=""===b?as3cf.tabs.defaultTab:b,a(".as3cf-sidebar.pro .block").not("."+b).hide(),a(".as3cf-sidebar.pro .block."+b+'[data-render="1"]').show()}function h(){var a="";return window.location.hash&&(a=window.location.hash.substring(1)),a=as3cf.tabs.sanitizeHash(a)}var i,j=ajaxurl.replace("/admin-ajax.php",""),k=j+"/images/spinner",l=null,m=a("body"),n=a(".as3cf-main");window.devicePixelRatio>=2&&(k+="-2x"),k+=".gif",as3cfpro.spinnerUrl=k;var o=function(){this.$key=n.find(".as3cf-licence-input"),this.$spinner=n.find("[data-as3cf-licence-spinner]"),this.$feedback=n.find("[data-as3cf-licence-feedback]")};o.prototype.activate=function(){var b=a.trim(this.$key.val());return""===b?(this.$feedback.addClass("notice-error"),void this.$feedback.html("<p>"+as3cfpro.strings.enter_licence_key+"</p>").show()):this.sendRequest("activate",{licence_key:b}).done(function(a){a.success&&a.data&&this.$key.val(a.data.masked_licence)}.bind(this)).fail(function(){this.$feedback.html("<p>"+as3cfpro.strings.register_licence_problem+"</p>").show()}.bind(this))},o.prototype.remove=function(){return this.sendRequest("remove").done(function(a){a.success&&this.$key.val("")}.bind(this))},o.prototype.check=function(){return this.sendRequest("check").fail(function(a){a.readyState<4||alert(as3cfpro.strings.licence_check_problem)})},o.prototype.sendRequest=function(c,d){var e={action:"as3cfpro_"+c+"_licence",_ajax_nonce:as3cfpro.nonces[c+"_licence"]};return b.isObject(d)&&(e=b.extend(e,d)),this.$spinner.addClass("is-active").show(),a.post(ajaxurl,e).done(function(a){this.$feedback.toggleClass("notice-success",a.success).toggleClass("notice-error",!a.success),a.data&&a.data.message&&this.$feedback.html("<p>"+a.data.message+"</p>").show(),a.success&&as3cf.reloadUpdated()}.bind(this)).always(function(){this.$spinner.removeClass("is-active").hide()}.bind(this))},i=b.once(d),n.on("click","[data-as3cf-licence-action]",function(b){var c=a(this).data("as3cfLicenceAction"),d=new o;b.preventDefault(),"function"==typeof d[c]&&d[c]()}),a(document).on("as3cf.tabRendered",function(b,c){"support"===c&&"1"===as3cfpro.strings.has_licence?i():"licence"===c&&a(".as3cf-licence-input").focus(),f(c),g(c)}),a(document).ready(function(){var b=h();f(b),g(b);var c=a("#tab-"+as3cf.tabs.defaultTab+" .as3cf-main-settings form");l=e(c),m.on("click",".reactivate-licence",function(b){b.preventDefault();var c=a("<div/>",{id:"processing-licence"}).html(as3cfpro.strings.attempting_to_activate_licence);c.append('<img src="'+as3cfpro.spinnerUrl+'" alt="" class="check-licence-ajax-spinner general-spinner" />'),a(".as3cf-invalid-licence").hide().after(c),a.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:"as3cfpro_reactivate_licence",nonce:as3cfpro.nonces.reactivate_licence},error:function(b,d,e){c.remove(),a(".as3cf-invalid-licence").show().html(as3cfpro.strings.activate_licence_problem),a(".as3cf-invalid-licence").append("<br /><br />"+as3cfpro.strings.status+": "+b.status+" "+b.statusText+"<br /><br />"+as3cfpro.strings.response+"<br />"+b.responseText)},success:function(b){return c.remove(),"undefined"!=typeof b.as3cfpro_error&&1===b.as3cfpro_error?void a(".as3cf-invalid-licence").html(b.body).show():"undefined"!=typeof b.dbrains_api_down&&1===b.dbrains_api_down?(a(".as3cf-invalid-licence").html(as3cfpro.strings.temporarily_activated_licence),void a(".as3cf-invalid-licence").append(b.body).show()):(a(".as3cf-invalid-licence").empty().html(as3cfpro.strings.licence_reactivated),a(".as3cf-invalid-licence").addClass("success notification-message success-notice").show(),void location.reload())}})}),m.on("click",".support-tab-link",function(a){as3cf.tabs.toggle("support")})})}(jQuery,_,as3cfModal);