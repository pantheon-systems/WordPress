jQuery(document).ready(function(e){var a;function t(){var a=e("#affiliate-wp-migrate-user-accounts input:checkbox:checked").length,t=e("#affiliate-wp-migrate-user-accounts input[type=submit]");a>0?t.prop("disabled",!1):t.prop("disabled",!0)}window.formfield="",e("body").on("click",".affwp_settings_upload_button",function(t){t.preventDefault();var i=e(this);window.formfield=e(this).parent().prev(),a?a.open():((a=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:i.data("uploader_title"),button:{text:i.data("uploader_button_text")},multiple:!1})).on("menu:render:default",function(e){e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set({})}),a.on("insert",function(){a.state().get("selection").each(function(e,a){e=e.toJSON(),window.formfield.val(e.url)})}),a.open())}),window.formfield="",e(".affwp-referrals-export-toggle").click(function(){e(".affwp-referrals-export-toggle").toggle(),e("#affwp-referrals-export-form").slideToggle()}),e(".affwp-datepicker").length&&e(".affwp-datepicker").datepicker({dateFormat:"mm/dd/yy"}),e(".affwp-user-search").each(function(){var a=e(this),t=a.val(),i=a.data("affwp-status"),o=a.closest("form");a.autocomplete({source:ajaxurl+"?action=affwp_search_users&term="+t+"&status="+i,delay:500,minLength:2,position:{offset:"0, -1"},search:function(){a.hasClass("affwp-enable-on-complete")&&(e("div.notice").remove(),e(".affwp-user-email-wrap, .affwp-user-pass-wrap").hide(),o.find("input, select").prop("disabled",!0))},open:function(){a.addClass("open")},close:function(){a.removeClass("open")},response:function(t,i){0===i.content.length&&a.hasClass("affwp-enable-on-complete")&&(e('<div class="notice notice-error affwp-new-affiliate-error"><p>'+affwp_vars.no_user_found+"</p></div>").insertAfter(a),o.find("input, select").prop("disabled",!1),e(".affwp-user-email-wrap, .affwp-user-pass-wrap").show(),e(".affwp-user-email").prop("required"),e(".search-description").hide())},select:function(){a.hasClass("affwp-enable-on-complete")&&e.ajax({type:"POST",url:ajaxurl,data:{action:"affwp_check_user_login",user:a.val()},dataType:"json",success:function(t){if(console.log(t),t.success)if(!1===t.data.affiliate)o.find("input, select").prop("disabled",!1);else{var i='<a href="'+t.data.url+'">'+affwp_vars.view_affiliate+"</a>";e('<div class="notice notice-info affwp-new-affiliate-error"><p>'+affwp_vars.existing_affiliate+" "+i+"</p></div>").insertAfter(a),a.prop("disabled",!1)}}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}})}),e("body").on("click",".upload_image_button",function(t){t.preventDefault();var i=e(this).prev();a?a.open():((a=wp.media.frames.file_frame=wp.media({frame:"select",title:"Choose Image",multiple:!1,library:{type:"image"},button:{text:"Use Image"}})).on("menu:render:default",function(e){e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set({})}),a.on("select",function(){var t=a.state().get("selection").first().toJSON();i.val(t.url);var o=e("<img />");o.attr("src",t.url),e("#preview_image").empty().append(o),e("#preview_image img")&&e("#preview_image").show()}),a.open())}),e("body").on("click",".affiliates_page_affiliate-wp-referrals .delete",function(e){return!!confirm(affwp_vars.confirm_delete_referral)}),t(),e("body").on("change","#affiliate-wp-migrate-user-accounts input:checkbox",function(){t()}),e("#affwp_add_affiliate #status").change(function(){"active"==e(this).val()?e("#affwp-welcome-email-row").show():(e("#affwp-welcome-email-row").hide(),e("#affwp-welcome-email-row #welcome_email").prop("checked",!1))}),"undefined"!=typeof postboxes&&/affiliate-wp/.test(pagenow)&&postboxes.add_postbox_toggles(pagenow)});