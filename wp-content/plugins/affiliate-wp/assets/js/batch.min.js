jQuery(document).ready(function(e){var a;(a={init:function(){this.submit()},submit:function(){var a=this;e(".affwp-batch-form").on("submit",function(t){t.preventDefault();var r=e(this).find('input[type="submit"]');if(!r.hasClass("button-disabled")){var i=e(this).data("ays");if(void 0!==i&&!confirm(i))return;var n={batch_id:e(this).data("batch_id"),nonce:e(this).data("nonce"),form:e(this).serializeAssoc()};r.addClass("button-disabled"),e(this).find(".notice-wrap").remove(),e(this).append('<div class="notice-wrap"><div class="affwp-batch-progress"><div></div></div></div>'),r.parent().append('<span class="spinner is-active"></span>'),a.process_step(1,n,a)}})},process_step:function(a,t,r){r=this;e.ajax({type:"POST",url:ajaxurl,data:{batch_id:t.batch_id,action:"process_batch_request",nonce:t.nonce,form:t.form,step:a,data:t},dataType:"json",success:function(a){if(a.data.done||a.data.error){var i=a.data.mapping?".affwp-batch-import-form":".affwp-batch-form",n=e(i),s=n.find(".spinner"),o=n.find(".notice-wrap");n.find(".button-disabled").removeClass("button-disabled"),a.data.error?(s.remove(),o.html('<div class="updated error"><p>'+a.data.error+"</p></div>")):a.data.done?(s.remove(),o.html('<div id="affwp-batch-success" class="updated notice"><p class="affwp-batch-success">'+a.data.message+"</p></div>"),a.data.url&&(window.location=a.data.url)):o.remove()}else e(".affwp-batch-progress div").animate({width:a.data.percentage+"%"},50,function(){}),r.process_step(parseInt(a.data.step),t,r)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}).init(),e.extend({},a,{submit:function(){var a=this;e(".affwp-batch-import-form").each(function(t,r){e(this).ajaxForm({beforeSubmit:a.before_submit,complete:a.complete,dataType:"json",error:a.error,data:{action:"process_batch_import",batch_id:e(this).data("batch_id"),nonce:e(this).data("nonce")},url:ajaxurl,resetForm:!0})})},before_submit:function(a,t,r){if(t.find(".notice-wrap").remove(),t.append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="affwp-batch-progress"><div></div></div></div>'),!(window.File&&window.FileReader&&window.FileList&&window.Blob)){var i=e(".affwp-batch-import-form").find(".affwp-batch-progress").parent().parent(),n=i.find(".notice-wrap");return i.find(".button-disabled").removeClass("button-disabled"),n.html('<div class="update error"><p>'+affwp_batch_vars.unsupported_browser+"</p></div>"),!1}},success:function(e,a,t,r){console.log(r)},complete:function(t){var r=jQuery.parseJSON(t.responseText),i=this;if(r.success){var n=e(".affwp-batch-import-form .notice-wrap").parent();n.find(".affwp-import-file-wrap, .notice-wrap").remove(),n.find(".affwp-import-options").slideDown();var s,o=n.find("select.affwp-import-csv-column"),d=(o.parent().parent(),""),p=r.data.columns.sort(function(e,a){return e<a?-1:e>a?1:0});e.each(o,function(a,t){currentSelect=e(this),s=e(t).attr("name"),e.each(p,function(e,a){processedColumnValue=a.toLowerCase().replace(/ /g,"_"),columnRegex=new RegExp("\\["+processedColumnValue+"\\]"),s.length&&s.match(columnRegex)?(d+='<option value="'+a+'" selected="selected">'+a+"</option>",0!=r.data.first_row[a]?currentSelect.parent().next().html(r.data.first_row[a]):currentSelect.parent().next().html("")):d+='<option value="'+a+'">'+a+"</option>"}),e(this).append(d),d=""}),o.on("change",function(){var a=e(this).val();a&&0!=r.data.first_row[a]?e(this).parent().next().html(r.data.first_row[a]):e(this).parent().next().html("")}),e("body").on("click",".affwp-import-proceed",function(t){if(t.preventDefault(),n.data("required")){var s=n.data("required"),o=[];o=s.indexOf(",")?s.split(","):[s];var d=!1;if(e.each(o,function(a,t){field=e("select[name='affwp-import-field["+t+"]']"),tableRow=field.parent().parent(),tableRow.removeClass("affwp-required-import-field"),""==field.val()&&(d=!0,tableRow.addClass("affwp-required-import-field"),field.parent().next().html(affwp_batch_vars.import_field_required))}),d)return}n.find(".notice-wrap").remove(),e(this).parent().append('<span class="spinner is-active"></span>'),n.append('<div class="notice-wrap"><div class="affwp-batch-progress"><div></div></div></div>'),r.data.mapping=n.serialize(),r.data.form=n.serializeAssoc(),a.process_step(1,r.data,i)})}else i.error(t)},error:function(a){var t=jQuery.parseJSON(a.responseText),r=e(".affwp-batch-import-form").find(".affwp-batch-progress").parent().parent(),i=r.find(".notice-wrap");r.find(".button-disabled").removeClass("button-disabled"),t.data.error?i.html('<div class="update error"><p>'+t.data.error+"</p></div>"):i.remove()}}).init(),e.extend({isArray:function(e){return!(!e||"object"!=typeof e||e.constructor!=Array)},arrayMerge:function(){for(var a={},t=0,r=e.arrayMerge.arguments,i=0;i<r.length;i++)if(e.isArray(r[i])){for(var n=0;n<r[i].length;n++)a[t++]=r[i][n];a=e.makeArray(a)}else for(var s in r[i])if(isNaN(s)){var o=r[i][s];"object"==typeof o&&a[s]&&(o=e.arrayMerge(a[s],o)),a[s]=o}else a[t++]=r[i][s];return a},count:function(a){if(e.isArray(a))return a.length;var t=0;for(var r in a)isNaN(r)||t++;return t}}),e.fn.extend({serializeAssoc:function(){for(var a={aa:{},add:function(a,t){var r=a.match(/^(.*)\[([^\]]*)\]$/);if(r){var i={};r[2]?i[r[2]]=t:i[e.count(i)]=t,this.add(r[1],i)}else"object"==typeof t?("object"!=typeof this.aa[a]&&(this.aa[a]={}),this.aa[a]=e.arrayMerge(this.aa[a],t)):this.aa[a]=t}},t=e(this).serializeArray(),r=0;r<t.length;r++)a.add(t[r].name,t[r].value);return a.aa}})});